"use strict";define("pages/open-course/programming/entry",["require","exports","module","q","underscore","bundles/discussions/viewModels/viewContext","bundles/ondemand/stores/CourseMembershipStore","bundles/phoenix/lib/exceptions","bundles/phoenix/template/models/userIdentity","bundles/phoenix/utils/openers","js/lib/path","memoize!pages/open-course/common/promises/courseGrade","memoize!pages/open-course/common/promises/itemMetadata","pages/open-course/common/singletons/course","pages/open-course/common/singletons/courseMaterials","pages/open-course/common/singletons/courseProgress","pages/open-course/common/singletons/verificationDisplay","pages/open-course/common/utils/discussionsUrlBuilder","pages/open-course/common/utils/ensureEnrolled","pages/open-course/item/entry","bundles/programming/promises/immediate/assignmentParts","bundles/programming/promises/immediate/instructions","bundles/programming/promises/immediate/submissionHistory","bundles/programming/promises/learnerAssignment","bundles/programming/stores/submissionSummariesStore"],function(require,exports,module){function redirectToInstructionsIfUserRejectedEnroll(e){return function(i){if(i instanceof m.UserRejectedEnrollPromptException){var o=n(s,e);return o.then(function(e){throw new u.Redirect(e.getCourseRelativeLink())})}throw i}}function opener(a,m,u,g){var r=n(s,a),p=r.then(function(s){return"programming"!==s.getTypeName()?o({itemMetadata:s}):e(null)}),l=r.then(function(s){return _(["gradedProgramming","ungradedProgramming"]).contains(s.getTypeName())?M.load({itemMetadata:s,userId:i.get("id"),courseId:s.get("course").get("id"),itemId:s.get("id")}):e(null)}),f=e.all([r,d,w,c,t,p,g,l]).spread(function(e,s,r,n,i,o,t){return v(s.get("id")).then(function(r){return{"bundles/programming/views/layout":{id:"programmingLayout."+e.get("id")+"."+(new Date).getTime(),to:'[data-js="item-container"]',initialize:{subview:m,course:s,courseProgress:n,courseGrade:r,verificationDisplay:i,itemMetadata:e,learnerAssignment:o},regions:{body:t}}}})});return b.openItemView(f,a,u)}var e=require("q"),_=require("underscore"),g=require("bundles/discussions/viewModels/viewContext"),r=require("bundles/ondemand/stores/CourseMembershipStore"),u=require("bundles/phoenix/lib/exceptions"),i=require("bundles/phoenix/template/models/userIdentity"),p=require("bundles/phoenix/utils/openers"),I=require("js/lib/path"),v=require("memoize!pages/open-course/common/promises/courseGrade"),n=require("memoize!pages/open-course/common/promises/itemMetadata"),d=require("pages/open-course/common/singletons/course"),w=require("pages/open-course/common/singletons/courseMaterials"),c=require("pages/open-course/common/singletons/courseProgress"),t=require("pages/open-course/common/singletons/verificationDisplay"),l=require("pages/open-course/common/utils/discussionsUrlBuilder"),m=require("pages/open-course/common/utils/ensureEnrolled"),b=require("pages/open-course/item/entry"),f=require("bundles/programming/promises/immediate/assignmentParts"),y=require("bundles/programming/promises/immediate/instructions"),h=require("bundles/programming/promises/immediate/submissionHistory"),o=require("bundles/programming/promises/learnerAssignment"),M=require("bundles/programming/stores/submissionSummariesStore"),a="bundles/programming/views/",s=["gradedProgramming","programming","ungradedProgramming"];exports.instructions=function(r){var m="instructions",u=a+"instructions",i=n(s,r),d=i.then(function(s){return"programming"!==s.getTypeName()?o({itemMetadata:s}):e(null)}),g=i.then(function(e){return"programming"===e.getTypeName()?y({itemMetadata:e,courseId:e.get("course").get("id"),itemId:e.get("id")}):null}),c=i.then(function(e){return"programming"!==e.getTypeName()?o({itemMetadata:e}).then(function(e){return e.submissionLearnerSchema.get("instructions")}):null}),p=e.all([i,g,c,d,t]).spread(function(e,s,n,i,o){return _.object([u],[{id:"instructions",to:'[data-js="body-container"]',initialize:{itemMetadata:e,instructions:n||s,learnerAssignment:i,verificationDisplay:o}}])});return opener(r,"instructions",m,p)},exports.submission=function(u){var d="submission",g=a+"submission",c=n(s,u),p=c.then(function(n){var u=n.getTypeName();if(!_(s).contains(u))throw new Error("Unknown programming assignment type: "+u);var a,m;"programming"===n.getTypeName()?(a=f({itemMetadata:n,userId:i.get("id"),courseId:n.get("course").get("id"),itemId:n.get("id")}),m=h({itemMetadata:n,userId:i.get("id"),courseId:n.get("course").get("id"),itemId:n.get("id")})):(a=e(null),m=e(null));var d;return d="programming"!==n.getTypeName()?o({itemMetadata:n}):e(null),e.all([t,a,m,d,r.deferUntilLoaded()]).spread(function(e,s,o,t){return _.object([g],[{id:"submission",to:'[data-js="body-container"]',initialize:{itemMetadata:n,immediateSubmissionHistory:o,immediateAssignmentParts:s,learnerAssignment:t,verificationDisplay:e,showDebugTools:r.hasTeachingRole()||i.get("is_superuser")}}])})});return opener(u,"submission",d,p).then(m).fail(redirectToInstructionsIfUserRejectedEnroll(u))},exports.discussions=function(e,d,i,o,t){var r=l.buildUrl(i,o,t),a="bundles/discussions/components/DiscussionsBody",m=n(s,e),u=m.then(function(e){return _.object([a],[{id:"questions",to:'[data-js="body-container"]',props:{viewContext:new g({itemMetadata:e}),questionId:i,answerId:o,commentId:t,disableAjax:!0}}])});return opener(e,"discussions",r,u)},module.exports=p.validateOpeners(s,exports,"instructions","submission","discussions")});